<<<<<<< HEAD
'use strict';

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _utilities = require('./utilities');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var getTestIndexRules = function getTestIndexRules() {
  var content = _fs2.default.readFileSync(_path2.default.resolve(__dirname, '../../tests/rules/index.js'), 'utf-8');

  var result = content.split('\n').reduce(function (acc, line) {
=======
"use strict";

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _utilities = require("./utilities");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// @flow
const getTestIndexRules = () => {
  const content = _fs.default.readFileSync(_path.default.resolve(__dirname, '../../tests/rules/index.js'), 'utf-8'); // eslint-disable-next-line unicorn/no-reduce


  const result = content.split('\n').reduce((acc, line) => {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    if (acc.inRulesArray) {
      if (line === '];') {
        acc.inRulesArray = false;
      } else {
        acc.rules.push(line.replace(/^\s*'([^']+)',?$/, '$1'));
      }
    } else if (line === 'const reportingRules = [') {
      acc.inRulesArray = true;
    }

    return acc;
  }, {
    inRulesArray: false,
    rules: []
  });
<<<<<<< HEAD

  var rules = result.rules;
=======
  const rules = result.rules;
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f

  if (rules.length === 0) {
    throw new Error('Tests checker is broken - it could not extract rules from test index file.');
  }

  return rules;
};
<<<<<<< HEAD

=======
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
/**
 * Performed checks:
 *  - file `/tests/rules/assertions/<rule>.js` exists
 *  - rule is included in `reportingRules` variable in `/tests/rules/index.js`
 */
<<<<<<< HEAD
// @flow

var checkTests = function checkTests(rulesNames) {
  var testIndexRules = getTestIndexRules();

  var invalid = rulesNames.filter(function (names) {
    var testExists = (0, _utilities.isFile)(_path2.default.resolve(__dirname, '../../tests/rules/assertions', names[0] + '.js'));
    var inIndex = testIndexRules.includes(names[1]);

=======


const checkTests = rulesNames => {
  const testIndexRules = getTestIndexRules();
  const invalid = rulesNames.filter(names => {
    const testExists = (0, _utilities.isFile)(_path.default.resolve(__dirname, '../../tests/rules/assertions', names[0] + '.js'));
    const inIndex = testIndexRules.includes(names[1]);
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return !(testExists && inIndex);
  });

  if (invalid.length > 0) {
<<<<<<< HEAD
    var invalidList = invalid.map(function (names) {
      return names[0];
    }).join(', ');

=======
    const invalidList = invalid.map(names => {
      return names[0];
    }).join(', ');
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    throw new Error('Tests checker encountered an error in: ' + invalidList + '. ' + 'Make sure that for every rule you created test suite and included the rule name in `tests/rules/index.js` file.');
  }
};

checkTests((0, _utilities.getRules)());