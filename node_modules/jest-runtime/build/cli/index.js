'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.run = run;

function _os() {
<<<<<<< HEAD
  const data = _interopRequireDefault(require('os'));

  _os = function _os() {
=======
  const data = require('os');

  _os = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

<<<<<<< HEAD
function _path() {
  const data = _interopRequireDefault(require('path'));

  _path = function _path() {
=======
function path() {
  const data = _interopRequireWildcard(require('path'));

  path = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

function _chalk() {
  const data = _interopRequireDefault(require('chalk'));

<<<<<<< HEAD
  _chalk = function _chalk() {
=======
  _chalk = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

<<<<<<< HEAD
function _realpathNative() {
  const data = require('realpath-native');

  _realpathNative = function _realpathNative() {
=======
function _yargs() {
  const data = _interopRequireDefault(require('yargs'));

  _yargs = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

<<<<<<< HEAD
function _yargs() {
  const data = _interopRequireDefault(require('yargs'));

  _yargs = function _yargs() {
=======
function _console() {
  const data = require('@jest/console');

  _console = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

<<<<<<< HEAD
function _console() {
  const data = require('@jest/console');

  _console = function _console() {
=======
function _jestConfig() {
  const data = require('jest-config');

  _jestConfig = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

function _jestUtil() {
  const data = require('jest-util');

<<<<<<< HEAD
  _jestUtil = function _jestUtil() {
=======
  _jestUtil = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

function _jestValidate() {
  const data = require('jest-validate');

<<<<<<< HEAD
  _jestValidate = function _jestValidate() {
=======
  _jestValidate = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

<<<<<<< HEAD
function _jestConfig() {
  const data = require('jest-config');

  _jestConfig = function _jestConfig() {
=======
function _version() {
  const data = require('../version');

  _version = function () {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return data;
  };

  return data;
}

<<<<<<< HEAD
var _version = require('../version');

var args = _interopRequireWildcard(require('./args'));

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};
    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc =
            Object.defineProperty && Object.getOwnPropertyDescriptor
              ? Object.getOwnPropertyDescriptor(obj, key)
              : {};
          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }
    newObj.default = obj;
    return newObj;
  }
}

=======
var args = _interopRequireWildcard(require('./args'));

>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {default: obj};
}

<<<<<<< HEAD
function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};
    var ownKeys = Object.keys(source);
    if (typeof Object.getOwnPropertySymbols === 'function') {
      ownKeys = ownKeys.concat(
        Object.getOwnPropertySymbols(source).filter(function(sym) {
          return Object.getOwnPropertyDescriptor(source, sym).enumerable;
        })
      );
    }
    ownKeys.forEach(function(key) {
      _defineProperty(target, key, source[key]);
    });
  }
  return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}

function run(cliArgv, cliInfo) {
  const realFs = require('fs');

  const fs = require('graceful-fs');

  fs.gracefulify(realFs);
=======
function _getRequireWildcardCache() {
  if (typeof WeakMap !== 'function') return null;
  var cache = new WeakMap();
  _getRequireWildcardCache = function () {
    return cache;
  };
  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }
  if (obj === null || (typeof obj !== 'object' && typeof obj !== 'function')) {
    return {default: obj};
  }
  var cache = _getRequireWildcardCache();
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  var hasPropertyDescriptor =
    Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor
        ? Object.getOwnPropertyDescriptor(obj, key)
        : null;
      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}

/**
 * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
async function run(cliArgv, cliInfo) {
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
  let argv;

  if (cliArgv) {
    argv = cliArgv;
  } else {
    argv = _yargs()
      .default.usage(args.usage)
      .help(false)
      .version(false)
<<<<<<< HEAD
      .options(args.options).argv; // @ts-ignore: fix this at some point

    (0, _jestValidate().validateCLIOptions)(
      argv,
      _objectSpread({}, args.options, {
        deprecationEntries: _jestConfig().deprecationEntries
      })
    );
=======
      .options(args.options).argv;
    (0, _jestValidate().validateCLIOptions)(argv, {
      ...args.options,
      deprecationEntries: _jestConfig().deprecationEntries
    });
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
  }

  if (argv.help) {
    _yargs().default.showHelp();

    process.on('exit', () => (process.exitCode = 1));
    return;
  }

  if (argv.version) {
<<<<<<< HEAD
    console.log(`v${_version.VERSION}\n`);
=======
    console.log(`v${_version().VERSION}\n`);
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
    return;
  }

  if (!argv._.length) {
    console.log('Please provide a path to a script. (See --help for details)');
    process.on('exit', () => (process.exitCode = 1));
    return;
  }

<<<<<<< HEAD
  const root = (0, _realpathNative().sync)(process.cwd());

  const filePath = _path().default.resolve(root, argv._[0]);

  if (argv.debug) {
    const info = cliInfo ? ', ' + cliInfo.join(', ') : '';
    console.log(`Using Jest Runtime v${_version.VERSION}${info}`);
  } // TODO: Figure this out
  // @ts-ignore: this might not have the correct arguments

  const options = (0, _jestConfig().readConfig)(argv, root);
  const globalConfig = options.globalConfig; // Always disable automocking in scripts.

  const config = _objectSpread({}, options.projectConfig, {
    automock: false,
    unmockedModulePathPatterns: null
  }); // Break circular dependency

  const Runtime = require('..');

  Runtime.createContext(config, {
    maxWorkers: Math.max(_os().default.cpus().length - 1, 1),
    watchman: globalConfig.watchman
  })
    .then(hasteMap => {
      const Environment = require(config.testEnvironment);

      const environment = new Environment(config);
      (0, _jestUtil().setGlobal)(
        environment.global,
        'console',
        new (_console()).CustomConsole(process.stdout, process.stderr)
      );
      (0, _jestUtil().setGlobal)(
        environment.global,
        'jestProjectConfig',
        config
      );
      (0, _jestUtil().setGlobal)(
        environment.global,
        'jestGlobalConfig',
        globalConfig
      );
      const runtime = new Runtime(config, environment, hasteMap.resolver);
      runtime.requireModule(filePath);
    })
    .catch(e => {
      console.error(_chalk().default.red(e.stack || e));
      process.on('exit', () => (process.exitCode = 1));
    });
=======
  const root = (0, _jestUtil().tryRealpath)(process.cwd());
  const filePath = path().resolve(root, argv._[0]);

  if (argv.debug) {
    const info = cliInfo ? ', ' + cliInfo.join(', ') : '';
    console.log(`Using Jest Runtime v${_version().VERSION}${info}`);
  }

  const options = await (0, _jestConfig().readConfig)(argv, root);
  const globalConfig = options.globalConfig; // Always disable automocking in scripts.

  const config = {...options.projectConfig, automock: false};

  const Runtime = require('..');

  try {
    var _runtime$unstable_sho2;

    const hasteMap = await Runtime.createContext(config, {
      maxWorkers: Math.max((0, _os().cpus)().length - 1, 1),
      watchman: globalConfig.watchman
    });

    const Environment = require(config.testEnvironment);

    const environment = new Environment(config);
    (0, _jestUtil().setGlobal)(
      environment.global,
      'console',
      new (_console().CustomConsole)(process.stdout, process.stderr)
    );
    (0, _jestUtil().setGlobal)(environment.global, 'jestProjectConfig', config);
    (0, _jestUtil().setGlobal)(
      environment.global,
      'jestGlobalConfig',
      globalConfig
    );
    const runtime = new Runtime(
      config,
      environment,
      hasteMap.resolver,
      undefined,
      undefined,
      filePath
    );

    for (const path of config.setupFiles) {
      var _runtime$unstable_sho;

      // TODO: remove ? in Jest 26
      const esm =
        (_runtime$unstable_sho = runtime.unstable_shouldLoadAsEsm) === null ||
        _runtime$unstable_sho === void 0
          ? void 0
          : _runtime$unstable_sho.call(runtime, path);

      if (esm) {
        await runtime.unstable_importModule(path);
      } else {
        runtime.requireModule(path);
      }
    } // TODO: remove ? in Jest 26

    const esm =
      (_runtime$unstable_sho2 = runtime.unstable_shouldLoadAsEsm) === null ||
      _runtime$unstable_sho2 === void 0
        ? void 0
        : _runtime$unstable_sho2.call(runtime, filePath);

    if (esm) {
      await runtime.unstable_importModule(filePath);
    } else {
      runtime.requireModule(filePath);
    }
  } catch (e) {
    console.error(_chalk().default.red(e.stack || e));
    process.on('exit', () => (process.exitCode = 1));
  }
>>>>>>> b459a022f47e1c55fb538e6c6b01f47908ccd92f
}
